{# templates/conffiles/postfix/_master.cf.twig #}

{# SECCIÓN: SMTP Estándar #}
{# nombre tipo privado unpriv chroot wakeup maxproc comando #}
smtp inet n - n - - smtpd


{# Puerto 587: Client Submission #}
submission inet n - n - - smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=encrypt
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_reject_unlisted_recipient=no
  -o smtpd_recipient_restrictions=
  -o smtpd_relay_restrictions=permit_sasl_authenticated,reject
  -o milter_macro_daemon_name=ORIGINATING
{% if dovecot %}
  -o smtpd_sasl_type=dovecot
  -o smtpd_sasl_path=private/auth
{% endif %}

{% if has_amavis %}
{# SECCIÓN: Amavis (Transporte y Retorno) #}
smtp-amavis unix - - n - 2 smtp
  -o syslog_name=postfix/amavis
  -o smtp_data_done_timeout=1200
  -o smtp_send_xforward_command=yes
  -o disable_dns_lookups=yes
  -o max_use=20

127.0.0.1:10025 inet n - n - - smtpd
  -o syslog_name=postfix/amavis-return
  -o content_filter=
  -o receive_override_options=no_header_body_checks,no_unknown_recipient_checks,no_milters
{% endif %}
